# autoregressive model(自回归模型)
用上一个时刻和之前一些时刻的特征值，来预测下一时刻的特征值。也就是说，每一时刻的预测值都依赖于前几个时刻的数据。
# variance auto encoder(变分自编码器)
## 定义
满足一定概率分布的z，此分布由参数θ来描述-P<sub>θ</sub>(z)
high dimensional variable x：此分布是以z为条件的条件概率分布-P<sub>θ</sub>(x|z)
想要得到P<sub>θ</sub>(x|z)，需要知道z的概率分布，而想要知道z的概率分布，需要一个后验网络，通过x生成z。
## 结构
![](2023-07-31-17-12-23.png).png
[链接](https://zhuanlan.zhihu.com/p/34998569)
# diffusion model
## 基于马尔可夫(Markov)链假设的条件概率
马尔科夫链：A->B->C，C的条件概率只与B有关，与A无关。也就是说在此刻发生的事情与上一时刻有关，与更之前的时刻无关。

因此联合概率密度P(A,B,C)=P(C|B,A)*P(B|A)*P(A)=P(C|B)*P(B|A)*P(A)。
## 重参数化
在VAE中latent space的latent variance z~N(μ,σ<sup>2</sup>)，如果直接对z进行取样，会导致在反向传播时对参数μ、σ的不可导，导致梯度下降无法进行。
因此，应该先设置一个ε~N(0,1)，然后令z=μ+ε*σ，此时相当于ε作为输入z作为输出，那么在反向传播时对参数μ、σ的就可导。
## diffusion model 图示
![](2023-08-01-11-39-32.png)
其中X<sub>T</sub>至X<sub>0</sub>属于逆扩散过程，X<sub>0</sub>至X<sub>T</sub>属于扩散过程。
扩散过程就是加噪过程，最后生成高斯噪音。而逆扩散过程就是去噪过程，最后生成图片。
### 扩散过程
![](2023-08-01-11-46-12.png)
**x<sub>t</sub>是图片数据，而q(x<sub>t</sub>|x<sub>t-1</sub>)是正态分布，x<sub>t</sub>是从正态分布q(x<sub>t</sub>|x<sub>t-1</sub>)中采样得到的。**

从上一个时刻预测下一个时刻，是条件概率分布，此条件概率分布满足正态分布，如上图所示。且均值和方差只由上一时刻的概率分布和固定参数β<sub>t</sub>决定，没有需要训练的参数。

又因为扩散过程是一个马尔科夫链，所以联合分布就是条件分布的乘积。

**由上图公式所示**：在x<sub>t-1</sub>加噪至x<sub>t</sub>过程中，噪声的方差是由β<sub>t</sub>来确定的，噪声的均值是由β<sub>t</sub>和x<sub>t-1</sub>确定的。每一时刻的β<sub>t</sub>是固定的，随着时刻向后延伸，β<sub>t</sub>越来越大，此时下一时刻的概率分布越趋近于标准正态分布。

#### 扩散过程中的重参数化
因为x<sub>t</sub>是从正态分布q(x<sub>t</sub>|x<sub>t-1</sub>)中采样得到的，那么在反向传播时，对q(x<sub>t</sub>|x<sub>t-1</sub>)直接采样导致，对其正态分布中的均值和方差不可导，导致梯度下降中断，因此采用重整化，先从标准正态分布中采样，再用均值和方差计算出x<sub>t</sub>，保证可导。

![](2023-08-01-16-04-16.png)

上图便是重参数化，z都是从标准正态分布的采样。又根据独立正态分布的可加性，可知x<sub>t</sub>可由x<sub>0</sub>和参数α<sub>t</sub>、α<sub>t-1</sub>、...、α<sub>1</sub>直接确定。

![](2023-08-01-16-18-55.png)
其中第五步就是训练让下一时刻的概率分布越来越趋近于标准正态分布。

### 逆扩散过程
![](2023-08-01-16-40-14.png)
此时x<sub>t-1</sub>也是服从正态分布的，均值和方差都由x<sub>t</sub>和t决定。计算均值和方差需要各自训练一个神经网络来拟合。
由于均值和方差未知，显然p(x<sub>t-1</sub>|x<sub>t</sub>)不能通过x<sub>t</sub>直接得出，q(x<sub>t-1</sub>|x<sub>t</sub>,x<sub>0</sub>)可以由x<sub>t</sub>,x<sub>0</sub>直接得出。
![](2023-08-01-17-27-18.png)
![](2023-08-01-17-30-46.png)
上面两个公式算出方差和均值，其中均值中的x<sub>0</sub>可以用x<sub>t</sub>表示。
最终可算得只用x<sub>t</sub>和z<sub>t</sub>表示的均值,其中z<sub>t</sub>是需要训练的神经网络的，输入x<sub>t</sub>和时刻t，输出z<sub>t</sub>,训练使得z<sub>t</sub>越来越趋近于标准正态分布，也就是算法1。
![](2023-08-01-17-34-45.png)
z<sub>t</sub>是t时刻扩散过程时所加噪声，该噪声服从标准正态分布。这一时刻噪声的获取是利用了扩散过程时训练的神经网络：输入t时刻的x<sub>t</sub>，输出t时刻所加的噪声z<sub>t</sub>。
![](2023-08-01-18-08-35.png)
其中第四步就是重参数化，先通过扩散过程训练的神经网络：输入t时刻的x<sub>t</sub>，输出t时刻所加的噪声。然后得出p(x<sub>t-1</sub>|x<sub>t</sub>)的均值，前面算出的方差是常数，这样一来，均值和方差已知，就可以重参数化，从标准正态分布中采样出z，最后得出x<sub>t-1</sub>